#!/usr/bin/env bash
#
# zellij-rename-tab - Rename current zellij tab
#
# Usage: zellij-rename-tab <title>
#
# Uses $ZELLIJ_PANE_ID from environment automatically.
# Requires zellij-tab-status plugin to be installed and loaded.
# See: https://github.com/dapi/zellij-tab-status

set -euo pipefail

show_help() {
    cat <<'EOF'
zellij-rename-tab - Rename current zellij tab

Usage:
  zellij-rename-tab <title>

Examples:
  zellij-rename-tab "ðŸ¤– Working"
  zellij-rename-tab "#123"
  zellij-rename-tab "Feature: auth"

Requirements:
  - Must be run inside a zellij session
  - Requires zellij-tab-status plugin installed and loaded
  - Uses $ZELLIJ_PANE_ID from environment automatically

Install plugin:
  git clone https://github.com/dapi/zellij-tab-status
  cd zellij-tab-status && make install
  # Add to ~/.config/zellij/config.kdl:
  # load_plugins { "file:~/.config/zellij/plugins/zellij-tab-status.wasm" }
EOF
}

if [[ $# -lt 1 ]]; then
    show_help
    exit 0
fi

TITLE="$1"

# Exit early if not in zellij
if [[ -z "${ZELLIJ:-}" ]]; then
    echo "Warning: Not in zellij session, doing nothing" >&2
    exit 0
fi

if [[ -z "${ZELLIJ_PANE_ID:-}" ]]; then
    echo "Error: ZELLIJ_PANE_ID not set" >&2
    exit 1
fi

zellij pipe --name tab-rename -- "{\"pane_id\": \"$ZELLIJ_PANE_ID\", \"name\": \"$TITLE\"}"
